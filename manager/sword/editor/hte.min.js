/*!
 * ----------------------------------------------------------
 *  HTML TEXT EDITOR PLUGIN 1.0.5
 * ----------------------------------------------------------
 * Author: Taufik Nurrohman <http://latitudu.com>
 * Licensed under the MIT license.
 *
 * REQUIRES:
 * ==========================================================
 * [1]. https://github.com/tovic/simple-text-editor-library
 * [2]. https://fortawesome.github.io/Font-Awesome/icons
 * ==========================================================
 * ----------------------------------------------------------
 *
 */

var HTE=function(e,t){function n(e,t){e=e||{};for(var l in t)e[l]="object"==typeof t[l]?n(e[l],t[l]):t[l];return e}function l(e,t){var n=t.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),l=0;return l=o.defaultView&&o.defaultView.getComputedStyle?o.defaultView.getComputedStyle(e,null).getPropertyValue(t):e.style[n]}void 0!==t.prompt&&(t.prompts=t.prompt),void 0!==t.placeholder&&(t.placeholders=t.placeholder);var i=this,r=window,o=document,a=new Editor(e),c={tabSize:"    ",toolbar:!0,shortcut:!1,toolbarClass:"editor-toolbar",toolbarPosition:"before",buttonClassPrefix:"editor-toolbar-button editor-toolbar-button-",iconClassPrefix:"fa fa-",emptyElementSuffix:">",autoEncodeHTML:!0,STRONG:"strong",EM:"em",U:"u",STRIKE:'del datetime="%s"',UL:"ul",OL:"ol",buttons:{ok:"OK",yes:"Yes",no:"No",cancel:"Cancel",open:"Open",close:"Close",bold:"Bold",italic:"Italic",underline:"Underline",strike:"Strike",superscript:"Superscript",subscript:"Subscript",code:"Code",paragraph:"Paragraph",quote:"Quote",heading:"H1 \u2013 H6",link:"Link",image:"Image",ol:"Ordered List",ul:"Unordered List",rule:"Horizontal Rule",undo:"Undo",redo:"Redo"},prompts:{link_title:"link title goes here\u2026",link_title_title:"Link Title",link_url:"http://",link_url_title:"Link URL",image_url:"http://",image_url_title:"Image URL"},placeholders:{text:"text goes here\u2026",heading_text:"Heading",link_text:"link text",list_ul_text:"List Item",list_ol_text:"List Item",image_alt:"Image"},keydown:function(){},click:function(){},ready:function(){}},s=o.createElement("div"),u=o.createElement("div");i.modal=function(e,t){e=e||"modal";var n=o.body,l=n.scrollTop||o.documentElement.scrollTop;s.className="custom-modal-overlay custom-modal-"+e+"-overlay",s.onclick=function(){i.close(!0)},u.className="custom-modal custom-modal-"+e,u.innerHTML='<div class="custom-modal-header custom-modal-'+e+'-header"></div><div class="custom-modal-content custom-modal-'+e+'-content"></div><div class="custom-modal-action custom-modal-'+e+'-action"></div>',u.style.visibility="hidden",n.appendChild(s),n.appendChild(u),r.setTimeout(function(){var e=u.offsetWidth,t=u.offsetHeight;u.style.position="absolute",u.style.top="50%",u.style.left="50%",u.style.zIndex="9999",u.style.marginTop=l-t/2+"px",u.style.marginLeft="-"+e/2+"px",u.style.visibility="",u.offsetTop<0&&(u.style.top=0,u.style.marginTop=0),u.offsetLeft<0&&(u.style.left=0,u.style.marginLeft=0)},10),"function"==typeof t&&t(s,u)},i.close=function(e){if(s&&o.body.removeChild(s),u&&o.body.removeChild(u),void 0!==e&&e===!0){var t=a.selection();a.select(t.start,t.end)}},i.prompt=function(e,t,n,l){i.modal("prompt",function(a,c){var s=function(e){"function"==typeof l?(i.close(),l(e)):i.close(!0)},u=o.createElement("input");u.type="text",u.value=t,u.onkeyup=function(e){n?13==e.keyCode&&""!==this.value&&this.value!==t&&s(this.value):13==e.keyCode&&s(this.value==t?"":this.value)};var p=o.createElement("button");p.innerHTML=f.buttons.ok,p.onclick=function(){n?""!==u.value&&u.value!==t&&s(u.value):s(u.value==t?"":u.value)};var d=o.createElement("button");d.innerHTML=f.buttons.cancel,d.onclick=function(){i.close(!0)},c.children[0].innerHTML=e?e:"",c.children[1].appendChild(u),c.children[2].appendChild(p),c.children[2].appendChild(o.createTextNode(" ")),c.children[2].appendChild(d),r.setTimeout(function(){u.select()},10)})},i.alert=function(e,t,n){i.modal("alert",function(l,r){var a=o.createElement("button");a.innerHTML=f.buttons.ok,a.onclick=function(){"function"==typeof n?(i.close(),n()):i.close(!0)},r.children[0].innerHTML=e?e:"",r.children[1].innerHTML=t?t:"",r.children[2].appendChild(a)})},i.confirm=function(e,t,n){i.modal("confirm",function(l,r){var a=o.createElement("button");a.innerHTML=f.buttons.ok,a.onclick=function(){void 0===n?i.close(!0):"function"==typeof n.OK?(i.close(),n.OK()):i.close(!0)};var c=o.createElement("button");c.innerHTML=f.buttons.cancel,c.onclick=function(){return void 0===n?i.close(!0):"function"==typeof n.CANCEL?(i.close(),n.CANCEL()):i.close(!0),!1},r.children[0].innerHTML=e?e:"",r.children[1].innerHTML=t?t:"",r.children[2].appendChild(a),r.children[2].appendChild(o.createTextNode(" ")),r.children[2].appendChild(c)})};var f=n(c,t),p=o.createElement("span"),d=/([!$^*\(\)\-+=\{\}\[\].,?\\\/])/g,g=f.tabSize.replace(d,"\\$1");f.toolbar&&(p.className=f.toolbarClass,a.area.parentNode.insertBefore(p,"before"==f.toolbarPosition?a.area:null)),i.button=function(e,t){if(t.title!==!1){var n=o.createElement("a");n.className=f.buttonClassPrefix+e,n.href="#"+e.replace(" ",":").replace(/[^a-z0-9\:]/gi,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,""),n.setAttribute("tabindex",-1),n.innerHTML=t.text?t.text.replace(/%s/g,e):'<i class="'+f.iconClassPrefix+e+'"></i>',n.onclick=function(e){return t.click(e,i),f.click(e,i,this.hash.replace("#","")),!1},t.title&&(n.title=t.title),t.position?p.insertBefore(n,p.children[t.position-1]):p.appendChild(n)}},a.toggle=function(e,t,n){var l=a.selection();if(l.before.slice(-e.length)!=e&&l.after.slice(0,t.length)!=t)a.wrap(e,t);else{var i=l.before.slice(-e.length)==e?l.before.substring(0,l.before.length-e.length):l.before,r=l.after.substring(0,t.length)==t?l.after.substring(t.length):l.after;a.area.value=i+l.value+r,a.select(i.length,i.length+l.value.length,function(){a.updateHistory()})}"function"==typeof n&&n()};var h=0,m=f.buttons,v={bold:{title:m.bold,click:function(){a.toggle("<"+f.STRONG+">","</"+f.STRONG.split(" ")[0]+">")}},italic:{title:m.italic,click:function(){a.toggle("<"+f.EM+">","</"+f.EM.split(" ")[0]+">")}},underline:{title:m.underline,click:function(){a.toggle("<"+f.U+">","</"+f.U.split(" ")[0]+">")}},strikethrough:{title:m.strike,click:function(){var e=new Date,t=e.getDate(),n=e.getMonth()+1,l=e.getFullYear();10>t&&(t="0"+t),10>n&&(n="0"+n),a.toggle("<"+f.STRIKE.replace(/%s/g,l+"-"+n+"-"+t)+">","</"+f.STRIKE.split(" ")[0]+">")}},code:{title:m.code,click:function(){var e=a.selection().value,t=-1===e.indexOf("\n"),n=t?"<code>":"<pre><code>",l=t?"</code>":"</code></pre>";if(e.length>0){var i=a.selection(),r=i.before,o=i.after,c=i.value;r.match(/(<pre(>| .*?>))?<code(>| .*?>)$/)&&o.match(/^<\/code>(<\/pre>)?/)?(r=r.replace(/(<pre(>| .*?>))?<code(>| .*?>)$/,""),o=o.replace(/^<\/code>(<\/pre>)?/,""),f.autoEncodeHTML&&(c=c.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")),a.area.value=r+c+o,a.select(r.length,r.length+c.length,function(){a.updateHistory()})):(f.autoEncodeHTML&&(c=c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),a.area.value=r+n+c+l+o,a.select(r.length+n.length,r.length+c.length+n.length,function(){a.updateHistory()}))}else a.toggle(n,l)}},paragraph:{title:m.paragraph,click:function(){var e=a.selection().value;e.length>0?/^<p(>| .*?>)|<\/p>$/.test(e)?a.replace(/<p(>| .*?>)([\s\S]*?)<\/p>/g,"$2"):(a.replace(/^/,"<p>"),a.replace(/$/,"</p>"),a.replace(/\n/g,"</p>\n<p>"),a.replace(/<p(>| .*?>)<\/p>/g,""),a.replace(/(<p(>| .*?>))+/g,"$1"),a.replace(/(<\/p>)+/g,"$1")):a.toggle("<p>","</p>")}},"quote-right":{title:m.quote,click:function(){a.toggle("<blockquote>","</blockquote>")}},header:{title:m.heading,click:function(){var e=a.selection(),t="<(?:h[1-6]|p)(>| .*?>)",n=e.value.match(RegExp("^"+t))?RegExp("^"+t).exec(e.value):RegExp(t+"$").exec(e.before);if(n=n?n[1]:">",h=6>h?h+1:0,e.value.length>0)if(e.before.match(/<(?:h[1-6]|p)(>| .*?>)$/)){var l=e.before.replace(/<(?:h[1-6]|p)(>| .*?>)$/g,""),i=e.value.replace(/^<(?:h[1-6]|p)(>| .*?>)|<\/(?:h[1-6]|p)>$/g,""),r=e.after.replace(/^<\/(?:h[1-6]|p)>/g,"");a.area.value=l+(h>0?"<h"+h+n:"<p"+n)+i+(h>0?"</h"+h+">":"</p>")+r,a.select(l.length+(h>0?n.length+3:n.length+2),l.length+(h>0?n.length+3:n.length+2)+i.length,function(){a.updateHistory()})}else a.wrap(h>0?"<h"+h+n:"<p"+n,h>0?"</h"+h+">":"</p>",function(){a.replace(/^<(?:h[1-6]|p)(>| .*?>)|<\/(?:h[1-6]|p)>$/g,"")});else{var o=f.placeholders.heading_text;h=1,a.insert("<h"+h+">"+o+"</h"+h+">",function(){e=a.selection().end,a.select(e-o.length-5,e-5,function(){a.updateHistory()})})}}},link:{title:m.link,click:function(){var e,t,n=a.selection(),l=f.placeholders.link_text;i.prompt(f.prompts.link_title_title,f.prompts.link_title,!1,function(r){e=r,i.prompt(f.prompts.link_url_title,f.prompts.link_url,!0,function(i){t=i,0===n.value.length?a.insert('<a href="'+t+'"'+(""!==e?' title="'+e+'"':"")+">"+l+"</a>",function(){var e=a.selection().end;a.select(e-l.length-4,e-4,function(){a.updateHistory()})}):a.wrap('<a href="'+t+'"'+(""!==e?' title="'+e+'"':"")+">","</a>")})})}},image:{title:m.image,click:function(){i.prompt(f.prompts.image_url_title,f.prompts.image_url,!0,function(e){var t=decodeURIComponent(e.substring(e.lastIndexOf("/")+1,e.lastIndexOf(".")).replace(/[-+._]+/g," ")).toLowerCase().replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()});t=-1===t.indexOf("/")&&-1!==e.indexOf(".")?t:f.placeholders.image_alt,a.insert('\n<img alt="'+t+'" src="'+e+'"'+f.emptyElementSuffix+"\n")})}},"list-ol":{title:m.ol,click:function(){var e=a.selection(),t=f.placeholders.list_ol_text;e.value.length>0?e.value==t?a.select(e.start,e.end):a.insert("<"+f.OL+">\n"+f.tabSize+"<li>"+e.value.replace(/\n/g,"</li>\n"+f.tabSize+"<li>").replace(RegExp("\n("+f.tabSize+")?<li></li>\n","g"),"\n</"+f.OL.split(" ")[0]+">\n\n<"+f.OL+">\n")+"</li>\n</"+f.OL.split(" ")[0]+">"):a.insert("<"+f.OL+">\n"+f.tabSize+"<li>"+t+"</li>\n</"+f.OL.split(" ")[0]+">",function(){a.select(e.start+f.tabSize.length+9,e.start+f.tabSize.length+9+t.length,function(){a.updateHistory()})})}},"list-ul":{title:m.ul,click:function(){var e=a.selection(),t=f.placeholders.list_ul_text;e.value.length>0?e.value==t?a.select(e.start,e.end):a.insert("<"+f.UL+">\n"+f.tabSize+"<li>"+e.value.replace(/\n/g,"</li>\n"+f.tabSize+"<li>").replace(RegExp("\n("+f.tabSize+")?<li></li>\n","g"),"\n</"+f.UL.split(" ")[0]+">\n\n<"+f.UL+">\n")+"</li>\n</"+f.UL.split(" ")[0]+">"):a.insert("<"+f.UL+">\n"+f.tabSize+"<li>"+t+"</li>\n</"+f.UL.split(" ")[0]+">",function(){a.select(e.start+f.tabSize.length+9,e.start+f.tabSize.length+9+t.length,function(){a.updateHistory()})})}},superscript:{title:m.superscript,click:function(){a.toggle("<sup>","</sup>")}},subscript:{title:m.subscript,click:function(){a.toggle("<sub>","</sub>")}},"ellipsis-h":{title:m.rule,click:function(){a.insert("\n<hr"+f.emptyElementSuffix+"\n")}},undo:{title:m.undo,click:function(){a.undo()}},repeat:{title:m.redo,click:function(){a.redo()}}};for(var b in v)i.button(b,v[b]);var k=function(e,t){return a.insert(e,function(){a.select(t.end+1)}),!1};a.area.onkeydown=function(e){var t=this,n=a.selection(),o=e.keyCode,c=e.ctrlKey,s=e.shiftKey,u=e.altKey,p=t.scrollTop+parseInt(l(t,"line-height"),10);r.setTimeout(function(){f.keydown(e,i)},10);var d=n.before,h=n.after[0],m="\\"==d.slice(-1);if(-1!==d.indexOf("(")&&s&&48==o&&")"==h&&!m||-1!==d.indexOf("{")&&s&&221==o&&"}"==h&&!m||-1!==d.indexOf("[")&&221==o&&"]"==h&&!m||-1!==d.indexOf('"')&&s&&222==o&&'"'==h&&!m||-1!==d.indexOf("'")&&!s&&222==o&&"'"==h&&!m||-1!==d.indexOf("`")&&!s&&192==o&&"`"==h&&!m||-1!==d.indexOf("<")&&s&&190==o&&">"==h&&!m)return a.select(n.end+1),!1;if(s&&57==o&&!m)return k("("+n.value+")",n);if(s&&219==o&&!m)return k("{"+n.value+"}",n);if(!s&&219==o&&!m)return k("["+n.value+"]",n);if(s&&222==o&&!m)return k('"'+n.value+'"',n);if(!s&&222==o&&!m)return k("'"+n.value+"'",n);if(!s&&192==o&&!m)return k("`"+n.value+"`",n);if(s&&188==o&&!m)return k("<"+n.value+">",n);if(s&&9==o)return a.outdent(g),!1;if(9==o){if(n.before.match(/<[^\/>]*?$/)&&">"==n.after[0]){var b=/<([^\/>]*?)$/.exec(n.before);return t.value=n.before+" "+n.value+"></"+b[1].split(" ")[0]+n.after,a.select(n.start+1,function(){a.updateHistory()}),!1}return a.indent(g),!1}if(c&&90==o)return a.undo(),!1;if(c&&89==o||c&&82==o)return a.redo(),!1;if(f.shortcut){if(c&&66==o)return v.bold.click(),!1;if(c&&73==o)return v.italic.click(),!1;if(c&&81==o)return v["quote-right"].click(),!1;if(s&&81==o&&n.value.length>0)return u?a.toggle("\u2018","\u2019"):a.toggle("\u201C","\u201D"),!1;if(c&&72==o)return v.header.click(),!1;if(c&&76==o)return v.link.click(),!1;if(c&&71==o)return v.image.click(),!1}if(13==o){if(c)return v.paragraph.click(),!1;if(s)return a.insert("<br"+f.emptyElementSuffix+"\n"),t.scrollTop=p,!1;if(n.before.match(/<\/li>$/)){var b=/(?:^|\n)([\t ]*)<li(>| .*?>).*?<\/li>$/.exec(n.before);return a.insert("\n"+b[1]+"<li"+b[2]+"</li>",function(){a.select(n.end+b[1].length+b[2].length+4,function(){a.updateHistory()})}),t.scrollTop=p,!1}if(n.after.match(/^<\/li>/)&&">"!=n.before.slice(-1)){var b=/(?:^|\n)([\t ]*)<li(>| .*?>).*$/.exec(n.before);return a.insert("</li>\n"+b[1]+"<li"+b[2]),t.scrollTop=p,!1}if(n.after.match(/^<\/p>/)){var b=/(?:^|\n)([\t ]*)<p(>| .*?>).*$/.exec(n.before);return a.insert("</p>\n"+b[1]+"<p"+b[2]),t.scrollTop=p,!1}var y=RegExp("(?:^|\n)(("+g+")+)(.*?)$").exec(n.before),x=y?y[1]:"";return n.before.match(/[\(\{\[]$/)&&n.after.match(/^[\]\}\)]/)||n.before.match(/<[^\/>]*?>$/)&&n.after.match(/^<\//)?(a.insert("\n"+x+f.tabSize+"\n"+x,function(){a.select(n.start+x.length+f.tabSize.length+1,function(){a.updateHistory()})}),t.scrollTop=p,!1):(a.insert("\n"+x),t.scrollTop=p,!1)}if(8==o&&0===n.value.length){if(n.before.match(RegExp(g+"$")))return a.outdent(g),!1;if(n.before.match(/<\/?[^>]*?>$/))return a.outdent("</?[^>]*?>"),!1;switch(n.before.slice(-1)){case"(":return a.toggle("(",")"),!1;case"{":return a.toggle("{","}"),!1;case"[":return a.toggle("[","]"),!1;case'"':return a.toggle('"','"'),!1;case"'":return a.toggle("'","'"),!1;case"<":return a.toggle("<",">"),!1;case"`":return a.toggle("`","`"),!1}}if(39==o&&n.after.match(/^<\/.*?>/)){var L=n.end+n.after.indexOf(">")+1;return a.select(L),!1}u||c||s||a.updateHistory()},f.ready(i),i.grip=a,i.grip.config=f};